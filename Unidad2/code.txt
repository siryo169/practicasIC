;deftemplate con es_condimento para sal, pimienta, aceite de oliva...

(defrule revocar_ingredientes_condimentos
  (declare (salience 6))
  (ingrediente_relevante (receta ?nombre) (ingrediente ?ingrediente))
  ?d <- (ingrediente_relevante (receta ?nombre) (ingrediente ?ingrediente))
  (es_condimento (nombre ?ingrediente))
  (not(recetas (nombre ?ingrediente)(ingrediente ?ingrediente)))
  =>
  (retract ?d)
)

(defrule revocar_importancia_pan
  (declare (salience 8))
  ?d <- (ingrediente_relevante (receta ?nombre) (ingrediente pan))
  (ingrediente_relevante (receta ?nombre) (ingrediente pan))
  (receta (nombre ?nombre) (tipo_plato primer_plato | plato_principal))
  =>
  (retract ?d)
)

(deftemplate es_condimento
(slot nombre)
)

(deftemplate ingrediente_relevante
(slot receta)
(slot ingrediente)
)

(defrule hacer_ingredientes_importantes
  (declare (salience 10))
  (receta (nombre ?nombre) (ingredientes $?ingredientes))
  =>
  (foreach ?ingrediente $?ingredientes 
    (assert (ingrediente_relevante (receta ?nombre) (ingrediente ?ingrediente))))
)

(defrule revocar_ingredientes_condimentos
  (declare (salience 9))
  (es_importante (receta ?nombre) (ingrediente ?ingrediente))
  ?d <- (es_importante (receta ?nombre) (ingrediente ?ingrediente))
  (es_condimento (nombre ?ingrediente))
  =>
  (retract ?d)
)

(defrule revocar_importancia_pan
  (declare (salience 8))
  ?d <- (es_importante (receta ?nombre) (ingrediente "pan"))
  (es_importante (receta ?nombre) (ingrediente "pan"))
  (receta (nombre ?nombre) (tipo_plato primer_plato | plato_principal))
  =>
  (retract ?d)
)

(defrule hacer_importante_aceite_desayuno
  (receta (nombre ?nombre) (tipo_plato desayuno))
  (receta (nombre ?nombre) (ingredientes $?ingredientes))
  (test (member$ "aceite" ?ingredientes))
  =>
  (assert (es_importante (receta ?nombre) (ingrediente "aceite") (valor si)))
)

(defrule hacer_importante_pan_desayuno
  (receta (nombre ?nombre) (tipo_plato desayuno))
  (receta (nombre ?nombre) (ingredientes $?ingredientes))
  (test (member$ "pan" ?ingredientes))
  =>
  (assert (es_importante (receta ?nombre) (ingrediente "pan") (valor si)))
)

(defrule hacer_importantes_pocos_ingredientes
  "Hacer importantes todos los ingredientes si la receta tiene dos o menos ingredientes"
  (receta (nombre ?nombre) (ingredientes $?ingredientes))
  (test (<= (length$ ?ingredientes) 2))
  (not (es_importante (receta ?nombre) (ingrediente $?) (valor si)))
  =>
  (foreach ?ingrediente ?ingredientes
    (assert (es_importante (receta ?nombre) (ingrediente ?ingrediente) (valor si))))
)


(defrule guarda_recetas
(declare (salience -1000))
=>
(save-facts "recetas.txt")
)

(defrule hacer_vagana
  (receta (nombre ?nombre) (ingredientes $?ingredientes))
  (test (forall (?ingrediente $?ingredientes)
               (not (derivados_animales (nombre ?ingrediente)))))
  =>
  (assert (propiedad_receta (propiedad es_vegana) (receta ?nombre)))
  )